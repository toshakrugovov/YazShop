{% extends 'base.html' %}
{% load static %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - YazShop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã</h1>
        <div class="dashboard-actions">
            <a href="{% url 'manager_dashboard' %}">‚Üê –ù–∞–∑–∞–¥</a>
            <a href="{% url 'manager_analytics_export_csv' %}?type=sales">–≠–∫—Å–ø–æ—Ä—Ç CSV (–ü—Ä–æ–¥–∞–∂–∏)</a>
            <a href="{% url 'manager_analytics_export_csv' %}?type=products">–≠–∫—Å–ø–æ—Ä—Ç CSV (–¢–æ–≤–∞—Ä—ã)</a>
            <a href="{% url 'manager_analytics_export_csv' %}?type=users">–≠–∫—Å–ø–æ—Ä—Ç CSV (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)</a>
            <a href="{% url 'manager_analytics_export_pdf' %}">–≠–∫—Å–ø–æ—Ä—Ç PDF</a>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>–ó–∞–∫–∞–∑–æ–≤ —Å–µ–≥–æ–¥–Ω—è</h3>
            <div class="value">{{ orders_today }}</div>
        </div>
        <div class="stat-card">
            <h3>–ó–∞–∫–∞–∑–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
            <div class="value">{{ orders_week }}</div>
        </div>
        <div class="stat-card">
            <h3>–ó–∞–∫–∞–∑–æ–≤ –∑–∞ –º–µ—Å—è—Ü</h3>
            <div class="value">{{ orders_month }}</div>
        </div>
        <div class="stat-card">
            <h3>–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
            <div class="value">{{ revenue_today }} ‚ÇΩ</div>
        </div>
        <div class="stat-card">
            <h3>–í—ã—Ä—É—á–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
            <div class="value">{{ revenue_week }} ‚ÇΩ</div>
        </div>
        <div class="stat-card">
            <h3>–í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü</h3>
            <div class="value">{{ revenue_month }} ‚ÇΩ</div>
        </div>
    </div>

    {% if product_of_week %}
    <div class="analytics-section">
        <h2>üèÜ –¢–æ–≤–∞—Ä –Ω–µ–¥–µ–ª–∏</h2>
        <div class="analytics-item">
            <div>
                <strong>{{ product_of_week.product_name }}</strong>
                <div style="font-size: 14px; color: var(--text-color-secondary); margin-top: 4px;">
                    –ü—Ä–æ–¥–∞–Ω–æ: {{ product_of_week.total_sold|default:0 }} —à—Ç. | 
                    –í—ã—Ä—É—á–∫–∞: {{ product_of_week.total_revenue|default:0 }} ‚ÇΩ
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if product_of_month %}
    <div class="analytics-section">
        <h2>üèÜ –¢–æ–≤–∞—Ä –º–µ—Å—è—Ü–∞</h2>
        <div class="analytics-item">
            <div>
                <strong>{{ product_of_month.product_name }}</strong>
                <div style="font-size: 14px; color: var(--text-color-secondary); margin-top: 4px;">
                    –ü—Ä–æ–¥–∞–Ω–æ: {{ product_of_month.total_sold|default:0 }} —à—Ç. | 
                    –í—ã—Ä—É—á–∫–∞: {{ product_of_month.total_revenue|default:0 }} ‚ÇΩ
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if popular_products %}
    <div class="analytics-section">
        <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (–∑–∞ –º–µ—Å—è—Ü)</h2>
        {% for product in popular_products %}
        <div class="analytics-item">
            <div>
                <strong>{{ product.product_name }}</strong>
                <div style="font-size: 14px; color: var(--text-color-secondary); margin-top: 4px;">
                    –ü—Ä–æ–¥–∞–Ω–æ: {{ product.total_sold|default:0 }} —à—Ç. | 
                    –í—ã—Ä—É—á–∫–∞: {{ product.total_revenue|default:0 }} ‚ÇΩ
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if category_stats %}
    <div class="section">
        <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
        <div class="category-header">
            <div>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
            <div>–¢–æ–≤–∞—Ä–æ–≤</div>
            <div>–ü—Ä–æ–¥–∞–Ω–æ</div>
            <div>–í—ã—Ä—É—á–∫–∞</div>
        </div>
        {% for cat in category_stats %}
        <div class="category-item">
            <div><strong>{{ cat.category_name }}</strong></div>
            <div>{{ cat.total_products|default:0 }}</div>
            <div>{{ cat.total_sold|default:0 }} —à—Ç.</div>
            <div>{{ cat.total_revenue|default:0 }} ‚ÇΩ</div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

