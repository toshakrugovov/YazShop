{% extends 'base.html' %}
{% load static %}

{% block title %}{% if brand %}Редактирование бренда{% else %}Добавление бренда{% endif %} - YazShop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="form-wrap">
    <h1>{% if brand %}Редактирование бренда{% else %}Добавление бренда{% endif %}</h1>
    <form id="brand-form" class="form-container">
        {% csrf_token %}
        <div id="form-error" style="color: #e74c3c; display: none; margin-bottom: 16px;"></div>
        <div class="form-group">
            <label for="brand_name">Название бренда *</label>
            <input type="text" id="brand_name" name="brand_name" value="{{ brand.brand_name|default:'' }}" required>
        </div>
        <div class="form-group">
            <label for="brand_country">Страна</label>
            <input type="text" id="brand_country" name="brand_country" value="{{ brand.brand_country|default:'' }}">
        </div>
        <div class="form-group">
            <label for="brand_description">Описание</label>
            <textarea id="brand_description" name="brand_description">{{ brand.brand_description|default:'' }}</textarea>
        </div>
        <div class="form-actions">
            <button type="submit" id="submit-btn">Сохранить</button>
            <a href="{% url 'admin_categories_list' %}">Отмена</a>
        </div>
    </form>

<script>
document.getElementById('brand-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const errorDiv = document.getElementById('form-error');
    const submitBtn = document.getElementById('submit-btn');
    errorDiv.style.display = 'none';
    
    const data = {
        brand_name: document.getElementById('brand_name').value.trim()
    };
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'Сохранение...';
    
    try {
        {% if brand %}
        const result = await ManagementAPI.brands.update({{ brand.id }}, data);
        {% else %}
        const result = await ManagementAPI.brands.create(data);
        {% endif %}
        
        if (result.success) {
            window.location.href = '{% url "admin_categories_list" %}';
        } else {
            errorDiv.textContent = result.error || 'Ошибка при сохранении бренда';
            errorDiv.style.display = 'block';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Сохранить';
        }
    } catch(err) {
        errorDiv.textContent = 'Ошибка соединения: ' + err.message;
        errorDiv.style.display = 'block';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Сохранить';
    }
});
</script>
</div>
{% endblock %}

