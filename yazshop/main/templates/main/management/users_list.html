{% extends 'base.html' %}
{% load static %}

{% block title %}Пользователи и роли{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="table-wrap">
  <div class="table-header">
    <h1>Пользователи и роли</h1>
    <div class="table-filters">
      <form method="get">
        <input type="text" name="q" value="{{ q }}" placeholder="Поиск по имени/почте">
      </form>
    </div>
  </div>

  <table class="data-table">
    <thead>
      <tr>
        <th>ID</th><th>Логин</th><th>Email</th><th>Имя</th><th>Фамилия</th><th>Роль</th><th>Статус</th><th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for u in page_obj.object_list %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ u.username }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.first_name }}</td>
        <td>{{ u.last_name }}</td>
        <td>{{ u.profile.role.role_name|default:"-" }}</td>
        <td>{{ u.profile.user_status|default:"-" }}</td>
        <td class="table-actions">
          <a href="{% url 'management_user_edit' user_id=u.id %}">Изменить</a>
          <form method="post" action="{% url 'management_user_toggle_block' user_id=u.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">{% if u.profile.user_status == 'blocked' %}Разблокировать{% else %}Заблокировать{% endif %}</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8">Нет пользователей</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="pager" style="margin-top:10px;">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}">← Назад</a>
    {% else %}<span>← Назад</span>{% endif %}
    <span>Стр. {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&q={{ q }}">Вперед →</a>
    {% else %}<span>Вперед →</span>{% endif %}
  </div>
</div>
{% endblock %}


